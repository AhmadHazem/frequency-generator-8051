C51 COMPILER V9.60.7.0   TIMER1                                                            04/22/2023 17:36:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER1
OBJECT MODULE PLACED IN .\Objects\timer1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE timer1.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ti
                    -mer1.lst) TABS(2) OBJECT(.\Objects\timer1.obj)

line level    source

   1          #include "timer1.h"
   2          #include "quad_7segment.h"
   3          
   4          unsigned int num;
   5          
   6          unsigned long int_loop;
   7          
   8          unsigned int ext_loop;
   9          unsigned int act_loop;
  10          
  11          unsigned int TH;
  12          unsigned int TL;
  13          
  14          sbit mybit = P3 ^ 7;
  15          
  16          
  17          void init_timer1()
  18          {
  19   1        // Set the timer mode to 16-bit mode
  20   1        TMOD |= 0x10;
  21   1      
  22   1        // Enable Timer 1 interrupt
  23   1        ET1 = 1;
  24   1      
  25   1        // Enable interrupts globally
  26   1        EA = 1;
  27   1      }
  28          
  29          void start_timer1()
  30          {
  31   1        // Set the timer reload value
  32   1        TH1 = TH;
  33   1        TL1 = TL;
  34   1      
  35   1        // Start Timer 1
  36   1        TR1 = 1;
  37   1      }
  38          
  39          void stop_timer1()  
  40          {
  41   1        // Reset the Timer 1 interrupt flag
  42   1        TF1 = 0;
  43   1      
  44   1        // Stop Timer 0
  45   1        TR1 = 0;
  46   1      }
  47          
  48          
  49          
  50          void delay_timer1(void) interrupt 3
  51          {
  52   1        // Toggle bit to produce square wave
  53   1        if (--act_loop == 0)
  54   1        {
C51 COMPILER V9.60.7.0   TIMER1                                                            04/22/2023 17:36:01 PAGE 2   

  55   2          mybit = ~mybit;
  56   2          // Reset the external loop index
  57   2          act_loop = ext_loop;
  58   2        }
  59   1        
  60   1        stop_timer1();
  61   1        start_timer1();
  62   1      }
  63          
  64          void set_sq_wave(unsigned int freq)
  65          {
  66   1        if (num != freq)
  67   1        {
  68   2          // Enable timer1
  69   2          init_timer1();
  70   2          
  71   2          // Set the frequency
  72   2          num = freq;
  73   2          
  74   2          // Calculating time needed for each high/low portion
  75   2          int_loop = 460800 / (num * 1.0) - 27;
  76   2          ext_loop = 1;
  77   2      
  78   2          // Consider the case where the loop count is greater than 65536
  79   2          if (int_loop > 65536)
  80   2          {
  81   3            ext_loop = 10;
  82   3            int_loop = int_loop / 10;
  83   3          }
  84   2          
  85   2          // Set TH and TL
  86   2          TH = (65536 - int_loop) / 256;
  87   2          TL = (65536 - int_loop) % 256;
  88   2          
  89   2          // Set the external loop index
  90   2          act_loop = ext_loop;
  91   2      
  92   2          // Start generating square wave
  93   2          start_timer1();
  94   2        }
  95   1        else if (freq == 0)
  96   1        {
  97   2          // Stop generating square wave when freq=0
  98   2          mybit = 0;
  99   2          stop_timer1();
 100   2        }
 101   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    261    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
